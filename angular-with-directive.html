<html ng-app='hnApp'>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>

        <script type="text/javascript">
            var hnApp = angular.module('hnApp', []);
            hnApp.controller('hnCtrl', function($scope, $http){
                $http.get('https://hacker-news.firebaseio.com/v0/topstories.json').success(function(data){
                    $scope.hn_ids = data;
                })
                .then(function(ids){
                    var info = [];
                    angular.forEach(ids.data, function(id){
                        $http.get('https://hacker-news.firebaseio.com/v0/item/'+id+'.json').success(function(data){
                            info.push(data);
                        })
                    })
                    $scope.hn_ids = info;
                });
            });
            hnApp.directive("hnlist", function() {
              return {
                restrict: "E",
                controller: function($scope, $http){
                    $http.get('https://hacker-news.firebaseio.com/v0/topstories.json').success(function(data){
                        console.log("here");
                        $scope.ids = data;
                    })
                },
                template: '<div ng-repeat="id in ids"><hnnews id="id" index="{{$index}}"></hnnews></div>'
              }
            })
            hnApp.directive("hnnews", function() {
                return {
                    restrict: "E",
                    scope: {
                        id: '=',
                        index: '@'
                    },
                    controller: function($scope, $http){
                        var id = $scope.id;
                        $http.get('https://hacker-news.firebaseio.com/v0/item/'+id+'.json').success(function(data){
                            $scope.news = data;
                        })
                    },
                    template: '<div><span>{{index}}. {{news.title}}</span> <span>{{news.score}}</span> </div>'
                }
            });
        </script>

    </head>
    <body ng-controller='hnCtrl'>
        <h1 class="page_title">Hacker News (using angular with directive)</h1>
        <hnlist></hnlist>
    </body>
</html>